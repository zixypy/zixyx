getgenv().silentAim = {
    Enabled = false,
    ShowFov = false,
    Fov = 200
}

getgenv().aimbot = {
    Enabled = false,
    ShowFov = false,
    Fov = 200,
    LockedTarget = nil
}

getgenv().exploits = {
    NoRecoil = false,
    NoSpread = false,
    FullAuto = false,
    InstantReload = false,
    RapidFire = false,
    InfiniteAmmo = false,
    InfiniteRange = false,
    InstantEquip = false,
}

getgenv().playerSettings = {
    Noclip = false,
    InfiniteJump = false,
    FlyEnabled = false,
    FlySpeed = 50,
}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local camera = workspace.CurrentCamera
local mouse = player:GetMouse()

local screenGui = Instance.new("ScreenGui")
screenGui.Parent = playerGui
screenGui.Name = "ToggleGui"
screenGui.ResetOnSpawn = false

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 100, 0, 50)
toggleButton.Position = UDim2.new(0, 10, 0.5, -25)
toggleButton.Text = "Open Script"
toggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 18
toggleButton.Parent = screenGui

local frame = Instance.new("ScrollingFrame")
frame.Size = UDim2.new(0, 350, 0, 300)
frame.Position = UDim2.new(0.5, -175, 0.5, -150)
frame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
frame.Visible = false
frame.CanvasSize = UDim2.new(0, 0, 0, 600)
frame.ScrollBarThickness = 5
frame.Parent = screenGui

local tabContainer = Instance.new("Frame")
tabContainer.Size = UDim2.new(1, 0, 0, 30)
tabContainer.Position = UDim2.new(0, 0, 0, 0)
tabContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
tabContainer.Parent = frame

local tabs = {"Legit", "Rage", "Visuals", "Exploits", "Players"}
local tabFrames = {}
local tabButtons = {}
local currentTab = "Rage"

for i, tabName in ipairs(tabs) do
    local tabButton = Instance.new("TextButton")
    tabButton.Size = UDim2.new(0, 70, 0, 30)
    tabButton.Position = UDim2.new(0, (i-1)*70, 0, 0)
    tabButton.Text = tabName
    tabButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    tabButton.Font = Enum.Font.SourceSansBold
    tabButton.TextSize = 14
    tabButton.Parent = tabContainer
    tabButtons[tabName] = tabButton

    local tabFrame = Instance.new("Frame")
    tabFrame.Size = UDim2.new(1, 0, 1, -30)
    tabFrame.Position = UDim2.new(0, 0, 0, 30)
    tabFrame.BackgroundTransparency = 1
    tabFrame.Visible = tabName == currentTab
    tabFrame.Parent = frame
    tabFrames[tabName] = tabFrame
end

local legitFrame = tabFrames.Legit

local aimbotButton = Instance.new("TextButton")
aimbotButton.Size = UDim2.new(0, 120, 0, 40)
aimbotButton.Position = UDim2.new(0.5, -60, 0, 10)
aimbotButton.Text = "Aimbot"
aimbotButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
aimbotButton.TextColor3 = Color3.fromRGB(255, 255, 255)
aimbotButton.Font = Enum.Font.SourceSansBold
aimbotButton.TextSize = 16
aimbotButton.Parent = legitFrame

local aimbotShowFovButton = Instance.new("TextButton")
aimbotShowFovButton.Size = UDim2.new(0, 120, 0, 40)
aimbotShowFovButton.Position = UDim2.new(0.5, -60, 0, 60)
aimbotShowFovButton.Text = "Show FOV"
aimbotShowFovButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
aimbotShowFovButton.TextColor3 = Color3.fromRGB(255, 255, 255)
aimbotShowFovButton.Font = Enum.Font.SourceSansBold
aimbotShowFovButton.TextSize = 16
aimbotShowFovButton.Parent = legitFrame

local aimbotFovLabel = Instance.new("TextLabel")
aimbotFovLabel.Size = UDim2.new(0, 120, 0, 30)
aimbotFovLabel.Position = UDim2.new(0, 20, 0, 110)
aimbotFovLabel.Text = "FOV Size: " .. getgenv().aimbot.Fov
aimbotFovLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
aimbotFovLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
aimbotFovLabel.Font = Enum.Font.SourceSansBold
aimbotFovLabel.TextSize = 14
aimbotFovLabel.Parent = legitFrame

local aimbotIncreaseFovButton = Instance.new("TextButton")
aimbotIncreaseFovButton.Size = UDim2.new(0, 30, 0, 30)
aimbotIncreaseFovButton.Position = UDim2.new(0.5, 60, 0, 110)
aimbotIncreaseFovButton.Text = "+"
aimbotIncreaseFovButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
aimbotIncreaseFovButton.TextColor3 = Color3.fromRGB(255, 255, 255)
aimbotIncreaseFovButton.Font = Enum.Font.SourceSansBold
aimbotIncreaseFovButton.TextSize = 14
aimbotIncreaseFovButton.Parent = legitFrame

local aimbotDecreaseFovButton = Instance.new("TextButton")
aimbotDecreaseFovButton.Size = UDim2.new(0, 30, 0, 30)
aimbotDecreaseFovButton.Position = UDim2.new(0.5, 95, 0, 110)
aimbotDecreaseFovButton.Text = "-"
aimbotDecreaseFovButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
aimbotDecreaseFovButton.TextColor3 = Color3.fromRGB(255, 255, 255)
aimbotDecreaseFovButton.Font = Enum.Font.SourceSansBold
aimbotDecreaseFovButton.TextSize = 14
aimbotDecreaseFovButton.Parent = legitFrame

local rageFrame = tabFrames.Rage

local silentAimButton = Instance.new("TextButton")
silentAimButton.Size = UDim2.new(0, 120, 0, 40)
silentAimButton.Position = UDim2.new(0.5, -60, 0, 10)
silentAimButton.Text = "Silent Aim/Semi Wallbang"
silentAimButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
silentAimButton.TextColor3 = Color3.fromRGB(255, 255, 255)
silentAimButton.Font = Enum.Font.SourceSansBold
silentAimButton.TextSize = 16
silentAimButton.Parent = rageFrame

local showFovButton = Instance.new("TextButton")
showFovButton.Size = UDim2.new(0, 120, 0, 40)
showFovButton.Position = UDim2.new(0.5, -60, 0, 60)
showFovButton.Text = "Show FOV"
showFovButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
showFovButton.TextColor3 = Color3.fromRGB(255, 255, 255)
showFovButton.Font = Enum.Font.SourceSansBold
showFovButton.TextSize = 16
showFovButton.Parent = rageFrame

local fovLabel = Instance.new("TextLabel")
fovLabel.Size = UDim2.new(0, 120, 0, 30)
fovLabel.Position = UDim2.new(0, 20, 0, 110)
fovLabel.Text = "FOV Size: " .. getgenv().silentAim.Fov
fovLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
fovLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
fovLabel.Font = Enum.Font.SourceSansBold
fovLabel.TextSize = 14
fovLabel.Parent = rageFrame

local increaseFovButton = Instance.new("TextButton")
increaseFovButton.Size = UDim2.new(0, 30, 0, 30)
increaseFovButton.Position = UDim2.new(0.5, 60, 0, 110)
increaseFovButton.Text = "+"
increaseFovButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
increaseFovButton.TextColor3 = Color3.fromRGB(255, 255, 255)
increaseFovButton.Font = Enum.Font.SourceSansBold
increaseFovButton.TextSize = 14
increaseFovButton.Parent = rageFrame

local decreaseFovButton = Instance.new("TextButton")
decreaseFovButton.Size = UDim2.new(0, 30, 0, 30)
decreaseFovButton.Position = UDim2.new(0.5, 95, 0, 110)
decreaseFovButton.Text = "-"
decreaseFovButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
decreaseFovButton.TextColor3 = Color3.fromRGB(255, 255, 255)
decreaseFovButton.Font = Enum.Font.SourceSansBold
decreaseFovButton.TextSize = 14
decreaseFovButton.Parent = rageFrame

local visualsFrame = tabFrames.Visuals

local boxEspButton = Instance.new("TextButton")
boxEspButton.Size = UDim2.new(0, 120, 0, 40)
boxEspButton.Position = UDim2.new(0.5, -60, 0, 10)
boxEspButton.Text = "Box ESP"
boxEspButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
boxEspButton.TextColor3 = Color3.fromRGB(255, 255, 255)
boxEspButton.Font = Enum.Font.SourceSansBold
boxEspButton.TextSize = 16
boxEspButton.Parent = visualsFrame

local nameEspButton = Instance.new("TextButton")
nameEspButton.Size = UDim2.new(0, 120, 0, 40)
nameEspButton.Position = UDim2.new(0.5, -60, 0, 60)
nameEspButton.Text = "Name ESP"
nameEspButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
nameEspButton.TextColor3 = Color3.fromRGB(255, 255, 255)
nameEspButton.Font = Enum.Font.SourceSansBold
nameEspButton.TextSize = 16
nameEspButton.Parent = visualsFrame

local distanceEspButton = Instance.new("TextButton")
distanceEspButton.Size = UDim2.new(0, 120, 0, 40)
distanceEspButton.Position = UDim2.new(0.5, -60, 0, 110)
distanceEspButton.Text = "Distance ESP"
distanceEspButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
distanceEspButton.TextColor3 = Color3.fromRGB(255, 255, 255)
distanceEspButton.Font = Enum.Font.SourceSansBold
distanceEspButton.TextSize = 16
distanceEspButton.Parent = visualsFrame

local exploitsFrame = tabFrames.Exploits

local noRecoilButton = Instance.new("TextButton")
noRecoilButton.Size = UDim2.new(0, 120, 0, 40)
noRecoilButton.Position = UDim2.new(0, 20, 0, 10)
noRecoilButton.Text = "No Recoil"
noRecoilButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
noRecoilButton.TextColor3 = Color3.fromRGB(255, 255, 255)
noRecoilButton.Font = Enum.Font.SourceSansBold
noRecoilButton.TextSize = 16
noRecoilButton.Parent = exploitsFrame

local noSpreadButton = Instance.new("TextButton")
noSpreadButton.Size = UDim2.new(0, 120, 0, 40)
noSpreadButton.Position = UDim2.new(0, 160, 0, 10)
noSpreadButton.Text = "No Spread"
noSpreadButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
noSpreadButton.TextColor3 = Color3.fromRGB(255, 255, 255)
noSpreadButton.Font = Enum.Font.SourceSansBold
noSpreadButton.TextSize = 16
noSpreadButton.Parent = exploitsFrame

local fullAutoButton = Instance.new("TextButton")
fullAutoButton.Size = UDim2.new(0, 120, 0, 40)
fullAutoButton.Position = UDim2.new(0, 20, 0, 60)
fullAutoButton.Text = "Full Auto Weapon"
fullAutoButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
fullAutoButton.TextColor3 = Color3.fromRGB(255, 255, 255)
fullAutoButton.Font = Enum.Font.SourceSansBold
fullAutoButton.TextSize = 16
fullAutoButton.Parent = exploitsFrame

local instantReloadButton = Instance.new("TextButton")
instantReloadButton.Size = UDim2.new(0, 120, 0, 40)
instantReloadButton.Position = UDim2.new(0, 160, 0, 60)
instantReloadButton.Text = "Instant Reload"
instantReloadButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
instantReloadButton.TextColor3 = Color3.fromRGB(255, 255, 255)
instantReloadButton.Font = Enum.Font.SourceSansBold
instantReloadButton.TextSize = 16
instantReloadButton.Parent = exploitsFrame

local rapidFireButton = Instance.new("TextButton")
rapidFireButton.Size = UDim2.new(0, 120, 0, 40)
rapidFireButton.Position = UDim2.new(0, 20, 0, 110)
rapidFireButton.Text = "Rapid Fire"
rapidFireButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
rapidFireButton.TextColor3 = Color3.fromRGB(255, 255, 255)
rapidFireButton.Font = Enum.Font.SourceSansBold
rapidFireButton.TextSize = 16
rapidFireButton.Parent = exploitsFrame

local infiniteAmmoButton = Instance.new("TextButton")
infiniteAmmoButton.Size = UDim2.new(0, 120, 0, 40)
infiniteAmmoButton.Position = UDim2.new(0, 160, 0, 110)
infiniteAmmoButton.Text = "Infinite Ammo"
infiniteAmmoButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
infiniteAmmoButton.TextColor3 = Color3.fromRGB(255, 255, 255)
infiniteAmmoButton.Font = Enum.Font.SourceSansBold
infiniteAmmoButton.TextSize = 16
infiniteAmmoButton.Parent = exploitsFrame

local infiniteRangeButton = Instance.new("TextButton")
infiniteRangeButton.Size = UDim2.new(0, 120, 0, 40)
infiniteRangeButton.Position = UDim2.new(0, 20, 0, 160)
infiniteRangeButton.Text = "Infinite Range"
infiniteRangeButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
infiniteRangeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
infiniteRangeButton.Font = Enum.Font.SourceSansBold
infiniteRangeButton.TextSize = 16
infiniteRangeButton.Parent = exploitsFrame

local instantEquipButton = Instance.new("TextButton")
instantEquipButton.Size = UDim2.new(0, 120, 0, 40)
instantEquipButton.Position = UDim2.new(0, 160, 0, 160)
instantEquipButton.Text = "Instant Equip"
instantEquipButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
instantEquipButton.TextColor3 = Color3.fromRGB(255, 255, 255)
instantEquipButton.Font = Enum.Font.SourceSansBold
instantEquipButton.TextSize = 16
instantEquipButton.Parent = exploitsFrame

local playersFrame = tabFrames.Players

local noclipButton = Instance.new("TextButton")
noclipButton.Size = UDim2.new(0, 120, 0, 40)
noclipButton.Position = UDim2.new(0, 20, 0, 10)
noclipButton.Text = "Noclip"
noclipButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
noclipButton.TextColor3 = Color3.fromRGB(255, 255, 255)
noclipButton.Font = Enum.Font.SourceSansBold
noclipButton.TextSize = 16
noclipButton.Parent = playersFrame

local infiniteJumpButton = Instance.new("TextButton")
infiniteJumpButton.Size = UDim2.new(0, 120, 0, 40)
infiniteJumpButton.Position = UDim2.new(0, 160, 0, 10)
infiniteJumpButton.Text = "Infinite Jump"
infiniteJumpButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
infiniteJumpButton.TextColor3 = Color3.fromRGB(255, 255, 255)
infiniteJumpButton.Font = Enum.Font.SourceSansBold
infiniteJumpButton.TextSize = 16
infiniteJumpButton.Parent = playersFrame

local flyButton = Instance.new("TextButton")
flyButton.Size = UDim2.new(0, 120, 0, 40)
flyButton.Position = UDim2.new(0, 20, 0, 60)
flyButton.Text = "Enable Fly"
flyButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
flyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
flyButton.Font = Enum.Font.SourceSansBold
flyButton.TextSize = 16
flyButton.Parent = playersFrame

local flySpeedLabel = Instance.new("TextLabel")
flySpeedLabel.Size = UDim2.new(0, 120, 0, 30)
flySpeedLabel.Position = UDim2.new(0, 160, 0, 60)
flySpeedLabel.Text = "Fly Speed: " .. getgenv().playerSettings.FlySpeed
flySpeedLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
flySpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
flySpeedLabel.Font = Enum.Font.SourceSansBold
flySpeedLabel.TextSize = 14
flySpeedLabel.Visible = false
flySpeedLabel.Parent = playersFrame

local flyIncreaseSpeedButton = Instance.new("TextButton")
flyIncreaseSpeedButton.Size = UDim2.new(0, 30, 0, 30)
flyIncreaseSpeedButton.Position = UDim2.new(0, 280, 0, 60)
flyIncreaseSpeedButton.Text = "+"
flyIncreaseSpeedButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
flyIncreaseSpeedButton.TextColor3 = Color3.fromRGB(255, 255, 255)
flyIncreaseSpeedButton.Font = Enum.Font.SourceSansBold
flyIncreaseSpeedButton.TextSize = 14
flyIncreaseSpeedButton.Visible = false
flyIncreaseSpeedButton.Parent = playersFrame

local flyDecreaseSpeedButton = Instance.new("TextButton")
flyDecreaseSpeedButton.Size = UDim2.new(0, 30, 0, 30)
flyDecreaseSpeedButton.Position = UDim2.new(0, 315, 0, 60)
flyDecreaseSpeedButton.Text = "-"
flyDecreaseSpeedButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
flyDecreaseSpeedButton.TextColor3 = Color3.fromRGB(255, 255, 255)
flyDecreaseSpeedButton.Font = Enum.Font.SourceSansBold
flyDecreaseSpeedButton.TextSize = 14
flyDecreaseSpeedButton.Visible = false
flyDecreaseSpeedButton.Parent = playersFrame

local function addUICorner(instance)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = instance
end
addUICorner(toggleButton)
addUICorner(frame)
addUICorner(tabContainer)
for _, button in pairs(tabButtons) do
    addUICorner(button)
end
addUICorner(silentAimButton)
addUICorner(showFovButton)
addUICorner(fovLabel)
addUICorner(increaseFovButton)
addUICorner(decreaseFovButton)
addUICorner(boxEspButton)
addUICorner(nameEspButton)
addUICorner(distanceEspButton)
addUICorner(aimbotButton)
addUICorner(aimbotShowFovButton)
addUICorner(aimbotFovLabel)
addUICorner(aimbotIncreaseFovButton)
addUICorner(aimbotDecreaseFovButton)
addUICorner(noRecoilButton)
addUICorner(noSpreadButton)
addUICorner(fullAutoButton)
addUICorner(instantReloadButton)
addUICorner(rapidFireButton)
addUICorner(infiniteAmmoButton)
addUICorner(infiniteRangeButton)
addUICorner(instantEquipButton)
addUICorner(noclipButton)
addUICorner(infiniteJumpButton)
addUICorner(flyButton)
addUICorner(flySpeedLabel)
addUICorner(flyIncreaseSpeedButton)
addUICorner(flyDecreaseSpeedButton)

local isOpen = false
local TweenService = game:GetService("TweenService")
local function toggleGui()
    isOpen = not isOpen
    toggleButton.Text = isOpen and "Close Script" or "Open Script"
    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut)
    local goal = { Size = isOpen and UDim2.new(0, 350, 0, 300) or UDim2.new(0, 350, 0, 0) }
    TweenService:Create(frame, tweenInfo, goal):Play()
    frame.Visible = true
end
toggleButton.MouseButton1Click:Connect(toggleGui)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.RightShift then
        toggleGui()
    end
end)

for tabName, button in pairs(tabButtons) do
    button.MouseButton1Click:Connect(function()
        currentTab = tabName
        for _, tabFrame in pairs(tabFrames) do
            tabFrame.Visible = false
        end
        tabFrames[tabName].Visible = true
        for _, btn in pairs(tabButtons) do
            btn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
        end
        button.BackgroundColor3 = Color3.fromRGB(120, 120, 120)
    end)
end
tabButtons[currentTab].BackgroundColor3 = Color3.fromRGB(120, 120, 120)

local silentFovCircle = Drawing.new("Circle")
silentFovCircle.Thickness = 2
silentFovCircle.NumSides = 100
silentFovCircle.Radius = getgenv().silentAim.Fov
silentFovCircle.Color = Color3.fromRGB(255, 255, 255)
silentFovCircle.Visible = false
silentFovCircle.Filled = false
silentFovCircle.Position = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)

local aimbotFovCircle = Drawing.new("Circle")
aimbotFovCircle.Thickness = 2
aimbotFovCircle.NumSides = 100
aimbotFovCircle.Radius = getgenv().aimbot.Fov
aimbotFovCircle.Color = Color3.fromRGB(255, 255, 255)
aimbotFovCircle.Visible = false
aimbotFovCircle.Filled = false
aimbotFovCircle.Position = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)

getgenv().espSettings = {
    BoxEnabled = false,
    NameEnabled = false,
    DistanceEnabled = false
}

local espCache = {}

local function createESP(character)
    local esp = {
        Box = Drawing.new('Square'),
        Name = Drawing.new('Text'),
        Distance = Drawing.new('Text'),
    }
    esp.Box.Thickness = 2
    esp.Box.Color = Color3.new(0.403922, 0.349020, 0.701961)
    esp.Box.Filled = false
    esp.Box.Visible = false
    esp.Name.Size = 16
    esp.Name.Color = Color3.new(1, 1, 1)
    esp.Name.Outline = true
    esp.Name.Center = true
    esp.Name.Visible = false
    esp.Distance.Size = 16
    esp.Distance.Color = Color3.new(1, 1, 1)
    esp.Distance.Outline = true
    esp.Distance.Center = true
    esp.Distance.Visible = false
    return esp
end

local function clearESP(character)
    if espCache[character] then
        espCache[character].Box:Remove()
        espCache[character].Name:Remove()
        espCache[character].Distance:Remove()
        espCache[character] = nil
    end
end

for _, p in ipairs(Players:GetPlayers()) do
    if p.Character then
        espCache[p.Character] = createESP(p.Character)
    end
end
Players.PlayerAdded:Connect(function(p)
    p.CharacterAdded:Connect(function(character)
        espCache[character] = createESP(character)
    end)
end)
Players.PlayerRemoving:Connect(function(p)
    if p.Character then
        clearESP(p.Character)
    end
end)

local function updateESP()
    if not (getgenv().espSettings.BoxEnabled or getgenv().espSettings.NameEnabled or getgenv().espSettings.DistanceEnabled) then
        for character, _ in pairs(espCache) do
            clearESP(character)
        end
        return
    end
    if not player.Character or not player.Character:FindFirstChild('HumanoidRootPart') then
        for character, _ in pairs(espCache) do
            clearESP(character)
        end
        return
    end
    local localRoot = player.Character.HumanoidRootPart
    for _, character in pairs(workspace:GetChildren()) do
        local actualPlayer = Players:GetPlayerFromCharacter(character)
        if not actualPlayer or actualPlayer == player then continue end
        if not character:FindFirstChild('HumanoidRootPart') or not character:FindFirstChild('Humanoid') then
            clearESP(character)
            continue
        end
        local humanoid = character.Humanoid
        if humanoid.Health <= 0 then
            clearESP(character)
            continue
        end
        if actualPlayer.Team == player.Team then
            clearESP(character)
            continue
        end
        local targetRoot = character.HumanoidRootPart
        local distance = (localRoot.Position - targetRoot.Position).Magnitude
        if distance > 325 then
            clearESP(character)
            continue
        end
        if not espCache[character] then
            espCache[character] = createESP(character)
        end
        local esp = espCache[character]
        local rootPos, onScreen = camera:WorldToViewportPoint(targetRoot.Position)
        if onScreen then
            local head = character:FindFirstChild("Head")
            local topPos = head and camera:WorldToViewportPoint(head.Position + Vector3.new(0, 1, 0)) or camera:WorldToViewportPoint(targetRoot.Position + Vector3.new(0, 3, 0))
            local bottomPos = camera:WorldToViewportPoint(targetRoot.Position - Vector3.new(0, 3, 0))
            local height = math.abs(topPos.Y - bottomPos.Y)
            local width = height * 0.5
            local centerPos = Vector2.new(rootPos.X, (topPos.Y + bottomPos.Y) / 2)
            esp.Box.Size = Vector2.new(width, height)
            esp.Box.Position = centerPos - Vector2.new(width / 2, height / 2)
            esp.Box.Visible = getgenv().espSettings.BoxEnabled
            esp.Name.Text = actualPlayer.Name
            esp.Name.Position = Vector2.new(rootPos.X, topPos.Y - 20)
            esp.Name.Visible = getgenv().espSettings.NameEnabled
            esp.Distance.Text = tostring(math.floor(distance)) .. " studs"
            esp.Distance.Position = Vector2.new(rootPos.X, bottomPos.Y + 5)
            esp.Distance.Visible = getgenv().espSettings.DistanceEnabled
        else
            esp.Box.Visible = false
            esp.Name.Visible = false
            esp.Distance.Visible = false
        end
    end
end

local function applyWeaponExploits()
    for _, v in next, ReplicatedStorage.Weapons:GetChildren() do
        for _, c in next, v:GetChildren() do
            for _, x in next, getconnections(c.Changed) do
                x:Disable()
            end
            if getgenv().exploits.FullAuto and c.Name == "Auto" then
                c.Value = true
            end
            if getgenv().exploits.NoRecoil and c.Name == "RecoilControl" then
                c.Value = 0
            end
            if getgenv().exploits.NoSpread and c.Name == "MaxSpread" then
                c.Value = 0
            end
            if getgenv().exploits.InstantReload and (c.Name == "ReloadTime" or c.Name == "AReload" or c.Name == "SReload" or c.Name == "EReload") then
                c.Value = 0
            end
            if getgenv().exploits.RapidFire and (c.Name == "FireRate" or c.Name == "BFireRate") then
                c.Value = 0.02
            end
            if getgenv().exploits.InfiniteAmmo and c.Name == "Ammo" then
                c.Value = 300
            end
            if getgenv().exploits.InfiniteRange and c.Name == "Range" then
                c.Value = 9e9
            end
            if getgenv().exploits.InstantEquip and c.Name == "EquipTime" then
                c.Value = 0
            end
        end
    end
end

local noclipConnection
local function toggleNoclip()
    if getgenv().playerSettings.Noclip then
        noclipConnection = RunService.Stepped:Connect(function()
            if not getgenv().playerSettings.Noclip or not player.Character then return end
            for _, part in pairs(player.Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end)
    else
        if noclipConnection then
            noclipConnection:Disconnect()
        end
    end
end

local jumpConnection
local holdingJump = false

local function toggleInfiniteJump()
    if getgenv().playerSettings.InfiniteJump then
        UserInputService.InputBegan:Connect(function(input, gameProcessed)
            if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.Space then
                holdingJump = true
            end
        end)

        UserInputService.InputEnded:Connect(function(input, gameProcessed)
            if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.Space then
                holdingJump = false
            end
        end)

        jumpConnection = RunService.RenderStepped:Connect(function()
            if holdingJump and getgenv().playerSettings.InfiniteJump then
                local character = player.Character
                if character and character:FindFirstChildOfClass("Humanoid") then
                    local humanoid = character:FindFirstChildOfClass("Humanoid")
                    humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end
        end)
    else
        if jumpConnection then
            jumpConnection:Disconnect()
            jumpConnection = nil
        end
    end
end

local flyConnection
local function toggleFly()
    if getgenv().playerSettings.FlyEnabled then
        local character = player.Character
        if not character or not character:FindFirstChild("HumanoidRootPart") then return end

        local humanoid = character:FindFirstChildOfClass("Humanoid")
        local hrp = character.HumanoidRootPart

        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
        bodyVelocity.Velocity = Vector3.zero
        bodyVelocity.Parent = hrp

        flyConnection = RunService.RenderStepped:Connect(function()
            if not getgenv().playerSettings.FlyEnabled then return end
            if not character or not humanoid or not hrp then return end

            local moveDirection = humanoid.MoveDirection

            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                moveDirection += Vector3.new(0, 1, 0)
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                moveDirection -= Vector3.new(0, 1, 0)
            end

            if moveDirection.Magnitude > 0 then
                bodyVelocity.Velocity = moveDirection.Unit * getgenv().playerSettings.FlySpeed
            else
                bodyVelocity.Velocity = Vector3.zero
            end
        end)
    else
        if flyConnection then
            flyConnection:Disconnect()
            flyConnection = nil
        end
        local character = player.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            local bv = character.HumanoidRootPart:FindFirstChild("BodyVelocity")
            if bv then bv:Destroy() end
        end
    end
end

local function getClosestPlayerForAimbot()
    local closest, distance = nil, getgenv().aimbot.Fov
    for _, character in workspace:GetChildren() do
        local actualPlayer = Players:GetPlayerFromCharacter(character)
        if not actualPlayer or actualPlayer == player or actualPlayer.Team == player.Team then continue end
        if not character:FindFirstChild("Head") or not character:FindFirstChild("HumanoidRootPart") or not character:FindFirstChild("Humanoid") then continue end
        local humanoid = character.Humanoid
        if humanoid.Health <= 0 then continue end
        local w2s, onscreen = camera:WorldToViewportPoint(character.Head.Position)
        if onscreen then
            local dist = (Vector2.new(w2s.X, w2s.Y) - (camera.ViewportSize / 2)).Magnitude
            if dist < distance then
                closest = character
                distance = dist
            end
        end
    end
    return closest
end

function getPlayersName()
    for i, v in pairs(game:GetChildren()) do
        if v.ClassName == "Players" then
            return v.Name
        end
    end
end

local players = getPlayersName()
local localPlayer = game[players].LocalPlayer

local silentAimConnection
local function toggleSilentAim()
    if getgenv().silentAim.Enabled then
        silentAimConnection = RunService.Heartbeat:Connect(function()
            coroutine.resume(coroutine.create(function()
                for _, v in pairs(game[players]:GetPlayers()) do
                    if v.Name ~= localPlayer.Name and v.Character then
                        local parts = {
                            "RightUpperLeg",
                            "LeftUpperLeg",
                            "HeadHB",
                            "HumanoidRootPart"
                        }
                        for _, partName in ipairs(parts) do
                            local part = v.Character:FindFirstChild(partName)
                            if part then
                                part.Transparency = 10
                                part.CanCollide = false
                                part.Size = Vector3.new(30, 30, 30)
                            end
                        end
                    end
                end
            end))
        end)
    else
        if silentAimConnection then
            silentAimConnection:Disconnect()
            silentAimConnection = nil
        end
        for _, v in pairs(game[players]:GetPlayers()) do
            if v.Name ~= localPlayer.Name and v.Character then
                local parts = {
                    "RightUpperLeg",
                    "LeftUpperLeg",
                    "HeadHB",
                    "HumanoidRootPart"
                }
                for _, partName in ipairs(parts) do
                    local part = v.Character:FindFirstChild(partName)
                    if part then
                        part.Transparency = 0
                        part.CanCollide = true
                        part.Size = Vector3.new(1, 1, 1)
                    end
                end
            end
        end
    end
end

RunService.RenderStepped:Connect(function(delta)
    silentFovCircle.Radius = getgenv().silentAim.Fov
    silentFovCircle.Position = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
    silentFovCircle.Visible = getgenv().silentAim.ShowFov

    aimbotFovCircle.Radius = getgenv().aimbot.Fov
    aimbotFovCircle.Position = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
    aimbotFovCircle.Visible = getgenv().aimbot.ShowFov

    updateESP()

    if getgenv().aimbot.Enabled and getgenv().aimbot.LockedTarget then
        local target = getgenv().aimbot.LockedTarget
        if target and target:FindFirstChild("Head") and target:FindFirstChild("Humanoid") and target.Humanoid.Health > 0 then
            local headPos, onScreen = camera:WorldToViewportPoint(target.Head.Position)
            if onScreen then
                local targetCFrame = CFrame.new(camera.CFrame.Position, target.Head.Position)
                camera.CFrame = camera.CFrame:Lerp(targetCFrame, 0.55)
            else
                getgenv().aimbot.LockedTarget = nil
            end
        else
            getgenv().aimbot.LockedTarget = nil
        end
    end
end)

local isMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed or not getgenv().aimbot.Enabled then return end

    if not isMobile and input.UserInputType == Enum.UserInputType.MouseButton2 then
        local closest = getClosestPlayerForAimbot()
        if closest then
            getgenv().aimbot.LockedTarget = closest
        end
    end

    if isMobile and input.UserInputType == Enum.UserInputType.Touch then
        local screenWidth = game:GetService("GuiService"):GetScreenResolution().X
        local touchX = input.Position.X
        if touchX > screenWidth * 0.6 then
            local closest = getClosestPlayerForAimbot()
            if closest then
                getgenv().aimbot.LockedTarget = closest
            end
        end
    end
end)

UserInputService.InputEnded:Connect(function(input, gameProcessed)
    if gameProcessed or not getgenv().aimbot.Enabled then return end

    if not isMobile and input.UserInputType == Enum.UserInputType.MouseButton2 then
        getgenv().aimbot.LockedTarget = nil
    end

    if isMobile and input.UserInputType == Enum.UserInputType.Touch then
        local screenWidth = game:GetService("GuiService"):GetScreenResolution().X
        local touchX = input.Position.X
        if touchX > screenWidth * 0.6 then
            getgenv().aimbot.LockedTarget = nil
        end
    end
end)

silentAimButton.MouseButton1Click:Connect(function()
    getgenv().silentAim.Enabled = not getgenv().silentAim.Enabled
    silentAimButton.Text = getgenv().silentAim.Enabled and "Silent Enabled" or "Silent Aim/Semi Wallbang"
    toggleSilentAim()
end)

showFovButton.MouseButton1Click:Connect(function()
    getgenv().silentAim.ShowFov = not getgenv().silentAim.ShowFov
    showFovButton.Text = getgenv().silentAim.ShowFov and "Hide FOV" or "Show FOV"
end)

increaseFovButton.MouseButton1Click:Connect(function()
    getgenv().silentAim.Fov = getgenv().silentAim.Fov + 50
    fovLabel.Text = "FOV Size: " .. getgenv().silentAim.Fov
end)

decreaseFovButton.MouseButton1Click:Connect(function()
    getgenv().silentAim.Fov = math.max(50, getgenv().silentAim.Fov - 50)
    fovLabel.Text = "FOV Size: " .. getgenv().silentAim.Fov
end)

aimbotButton.MouseButton1Click:Connect(function()
    getgenv().aimbot.Enabled = not getgenv().aimbot.Enabled
    aimbotButton.Text = getgenv().aimbot.Enabled and "Aimbot Enabled" or "Aimbot"
    if not getgenv().aimbot.Enabled then
        getgenv().aimbot.LockedTarget = nil
    end
end)

aimbotShowFovButton.MouseButton1Click:Connect(function()
    getgenv().aimbot.ShowFov = not getgenv().aimbot.ShowFov
    aimbotShowFovButton.Text = getgenv().aimbot.ShowFov and "Hide FOV" or "Show FOV"
end)

aimbotIncreaseFovButton.MouseButton1Click:Connect(function()
    getgenv().aimbot.Fov = getgenv().aimbot.Fov + 50
    aimbotFovLabel.Text = "FOV Size: " .. getgenv().aimbot.Fov
end)

aimbotDecreaseFovButton.MouseButton1Click:Connect(function()
    getgenv().aimbot.Fov = math.max(50, getgenv().aimbot.Fov - 50)
    aimbotFovLabel.Text = "FOV Size: " .. getgenv().aimbot.Fov
end)

boxEspButton.MouseButton1Click:Connect(function()
    getgenv().espSettings.BoxEnabled = not getgenv().espSettings.BoxEnabled
    boxEspButton.Text = getgenv().espSettings.BoxEnabled and "Box ESP Enabled" or "Box ESP"
end)

nameEspButton.MouseButton1Click:Connect(function()
    getgenv().espSettings.NameEnabled = not getgenv().espSettings.NameEnabled
    nameEspButton.Text = getgenv().espSettings.NameEnabled and "Name ESP Enabled" or "Name ESP"
end)

distanceEspButton.MouseButton1Click:Connect(function()
    getgenv().espSettings.DistanceEnabled = not getgenv().espSettings.DistanceEnabled
    distanceEspButton.Text = getgenv().espSettings.DistanceEnabled and "Distance ESP Enabled" or "Distance ESP"
end)

noRecoilButton.MouseButton1Click:Connect(function()
    getgenv().exploits.NoRecoil = not getgenv().exploits.NoRecoil
    noRecoilButton.Text = getgenv().exploits.NoRecoil and "No Recoil Enabled" or "No Recoil"
    applyWeaponExploits()
end)

noSpreadButton.MouseButton1Click:Connect(function()
    getgenv().exploits.NoSpread = not getgenv().exploits.NoSpread
    noSpreadButton.Text = getgenv().exploits.NoSpread and "No Spread Enabled" or "No Spread"
    applyWeaponExploits()
end)

fullAutoButton.MouseButton1Click:Connect(function()
    getgenv().exploits.FullAuto = not getgenv().exploits.FullAuto
    fullAutoButton.Text = getgenv().exploits.FullAuto and "Full Auto Enabled" or "Full Auto Weapon"
    applyWeaponExploits()
end)

instantReloadButton.MouseButton1Click:Connect(function()
    getgenv().exploits.InstantReload = not getgenv().exploits.InstantReload
    instantReloadButton.Text = getgenv().exploits.InstantReload and "Instant Reload Enabled" or "Instant Reload"
    applyWeaponExploits()
end)

rapidFireButton.MouseButton1Click:Connect(function()
    getgenv().exploits.RapidFire = not getgenv().exploits.RapidFire
    rapidFireButton.Text = getgenv().exploits.RapidFire and "Rapid Fire Enabled" or "Rapid Fire"
    applyWeaponExploits()
end)

infiniteAmmoButton.MouseButton1Click:Connect(function()
    getgenv().exploits.InfiniteAmmo = not getgenv().exploits.InfiniteAmmo
    infiniteAmmoButton.Text = getgenv().exploits.InfiniteAmmo and "Infinite Ammo Enabled" or "Infinite Ammo"
    applyWeaponExploits()
end)

infiniteRangeButton.MouseButton1Click:Connect(function()
    getgenv().exploits.InfiniteRange = not getgenv().exploits.InfiniteRange
    infiniteRangeButton.Text = getgenv().exploits.InfiniteRange and "Infinite Range Enabled" or "Infinite Range"
    applyWeaponExploits()
end)

instantEquipButton.MouseButton1Click:Connect(function()
    getgenv().exploits.InstantEquip = not getgenv().exploits.InstantEquip
    instantEquipButton.Text = getgenv().exploits.InstantEquip and "Instant Equip Enabled" or "Instant Equip"
    applyWeaponExploits()
end)

noclipButton.MouseButton1Click:Connect(function()
    getgenv().playerSettings.Noclip = not getgenv().playerSettings.Noclip
    noclipButton.Text = getgenv().playerSettings.Noclip and "Noclip Enabled" or "Noclip"
    toggleNoclip()
end)

infiniteJumpButton.MouseButton1Click:Connect(function()
    getgenv().playerSettings.InfiniteJump = not getgenv().playerSettings.InfiniteJump
    infiniteJumpButton.Text = getgenv().playerSettings.InfiniteJump and "Infinite Jump Enabled" or "Infinite Jump"
    toggleInfiniteJump()
end)

flyButton.MouseButton1Click:Connect(function()
    getgenv().playerSettings.FlyEnabled = not getgenv().playerSettings.FlyEnabled
    flyButton.Text = getgenv().playerSettings.FlyEnabled and "Fly Enabled" or "Enable Fly"
    flySpeedLabel.Visible = getgenv().playerSettings.FlyEnabled
    flyIncreaseSpeedButton.Visible = getgenv().playerSettings.FlyEnabled
    flyDecreaseSpeedButton.Visible = getgenv().playerSettings.FlyEnabled
    toggleFly()
end)

flyIncreaseSpeedButton.MouseButton1Click:Connect(function()
    getgenv().playerSettings.FlySpeed = getgenv().playerSettings.FlySpeed + 10
    flySpeedLabel.Text = "Fly Speed: " .. getgenv().playerSettings.FlySpeed
end)

flyDecreaseSpeedButton.MouseButton1Click:Connect(function()
    getgenv().playerSettings.FlySpeed = math.max(10, getgenv().playerSettings.FlySpeed - 10)
    flySpeedLabel.Text = "Fly Speed: " .. getgenv().playerSettings.FlySpeed
end)
